<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="sillenceSoft.schedulleCall.Repository.ScheduleRepository">
    <insert id="addSchedule" useGeneratedKeys="true" keyProperty="schedule.scheduleNo">
        insert into Schedule(userNo, modDt, week,  startHour, startMinute, endHour, endMinute, statusNo)
        values (${userNo}, #{schedule.modDt}, ${schedule.week},  ${schedule.startTime.hour},
        ${schedule.startTime.minute}, ${schedule.endTime.hour}, ${schedule.endTime.minute}, ${schedule.statusNo});
    </insert>

    <delete id="deleteSchedule">
        delete from Schedule where scheduleNo =  ${scheduleNo}
    </delete>

    <select id="getSchedule" resultType="sillenceSoft.schedulleCall.Dto.ScheduleResponseDto">
        select * from Schedule where userNo = ${userNo};
    </select>

    <select id="getScheduleStatusNo" resultType="Integer">
        <![CDATA[
            select statusNo
            from Schedule as a
            where a.week=${week} and a.userNo=${userNo} and
            ${hour} < a.endHour or (${hour} = a.endHour and ${minute} <= a.endMinute);
        ]]>
    </select>
</mapper>